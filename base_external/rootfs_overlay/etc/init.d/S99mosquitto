#!/bin/sh
### BEGIN INIT INFO
# Provides:          mosquitto
# Required-Start:    $network
# Required-Stop:     
# Default-Start:     2 3 4 5
# Default-Stop:      
# Short-Description: Start Mosquitto MQTT broker
### END INIT INFO

#!/bin/sh
DAEMON=/usr/sbin/mosquitto
CONF=/etc/mosquitto/mosquitto.conf

start() {
  echo "Starting Mosquitto..."
  mkdir -p /var/run/mosquitto /var/lib/mosquitto
  # If it's already running, skip
  if pidof mosquitto >/dev/null; then
    echo "Mosquitto already running"
    return 0
  fi
  # Start with your config; -d = daemonize
  "$DAEMON" -c "$CONF" -d
}

stop() {
  echo "Stopping Mosquitto..."
  killall mosquitto 2>/dev/null || true
}

status() {
  if pidof mosquitto >/dev/null; then
    echo "running"
  else
    echo "stopped"; return 1
  fi
}

# Default to "start" if no arg is given
action="${1:-start}"
case "$action" in
  start)   start ;;
  stop)    stop ;;
  restart) stop; start ;;
  status)  status ;;
  *) echo "Usage: $0 {start|stop|restart|status}"; exit 1 ;;
esac
exit 0
